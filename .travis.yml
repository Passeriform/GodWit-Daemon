language: rust
sudo: required
cache: cargo
rust:
- stable
- beta
- nightly
jobs:
  allow_failures:
  - rust: nightly
  fast_finish: true
addons:
  apt:
    packages:
    - libcurl4-openssl-dev
    - libzmq3-dev
    - libelf-dev
    - libdw-dev
    - cmake
    - gcc
    - binutils-dev
after_success: |
  wget https://github.com/SimonKagstrom/kcov/archive/master.tar.gz &&
  tar xzf master.tar.gz &&
  cd kcov-master &&
  mkdir build &&
  cd build &&
  cmake .. &&
  make &&
  sudo make install &&
  cd ../.. &&
  rm -rf kcov-master &&
  for file in target/debug/godwit_daemon-*[^\.d]; do mkdir -p "target/cov/$(basename $file)"; kcov --exclude-pattern=/.cargo,/usr/lib --verify "target/cov/$(basename $file)" "$file"; done &&
  bash <(curl -s https://codecov.io/bash) &&
  echo "Uploaded code coverage"
deploy:
  provider: cargo
  on:
    tags: true
  token:
    secure: Rdjhz/ESJfk5uo4r9YY30DwyjwrGeMgJqWJ+exuIsx0iUtDKi4UK+CT45NeIxIE08D5xJKspm5g4PvePIcH/hMmMpmIu59josCQzi3hkiZ1M/AAxDr5S7n1gaNyslDpGfTjQfPcI2AGTdj4u2FUqyUughrey8NtrjW9PrjVjqVRblCuLlttnuDwYYLSte/t6fXyPjgCeiyJOHbQwnjPFnGFN0jLu7VULPDbeo6PaUmd1EHdlzvf2MhBvw95FyYQpskLZeWmrFDvRghayu6vBnk7Gao4sogxII9LUq9sKvV+M0zG8ICS/kgzGRYzxZ35sfl8ja3NF/dvmo4TKKRTHwioWBlmqlV4gwXK2CTJPuaX2wjMrEcPc40hVP+EBnHgc/ejtFBHVS5miKDm2U+QEJVK2hRPtjISrI+hxGKRFcUMZj8/Xe/c16vd/5Oo9xV0PfsuDWlIKj+h6h2rcs7nxiYW8NG1zNs/tfsvHLhf021XVy5W5qJyHv205WQKzKEDNVA4c2PQoCbrFSrIK0lvVE+4mVr43PojEafEmwmxICu/WqpZkiOcQ1Ta8Y9ySzNAkHSK+50DHcdO5qoP+NJIc5MjyRPC5cr6Xant2xfFUHiXF3H3w4pNI+qPC125BTSd3+JGURU0tjgYIRahV5pZyG4NYiybod4Qc5V5QJf8RFdk=
